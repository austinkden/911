<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispatch Information</title>
    <style>
        body {
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            color: white;
            background-color: #323335;
        }
        .time-display {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 25px;
            font-weight: bold;
        }
        .strip {
            display: flex;
            flex-direction: column;
            margin-top: 15px;
            margin-bottom: 10px;
            border: 1px solid #414144;
            padding: 10px;
            border-radius: 10px;
            background-color: #212224;
        }
        .strip input, .strip button, .strip select {
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 5px;
            border: 1px solid #414144;
            border-radius: 3px;
            box-sizing: border-box;
            background-color: #2a2b2d;
            color: white;
        }
        .full-width {
            flex: 1;
        }
        .input-group {
            display: flex;
            justify-content: space-between;
        }
        .responding-units {
            flex: 0 0 950px;
        }
        .call-type {
            flex-grow: 1;
        }
        .map-page {
            width: 75px;
        }
        .place-name {
            width: 250px;
        }
        .map-place-container {
            display: flex;
        }
        .notes-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notes {
            flex: 1;
            margin-right: 10px;
        }
        .strip button {
            align-self: flex-start;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            padding: 10px 20px;
        }
        .strip button:hover {
            background-color: #ff3333;
        }
        .add-button, .delete-all-button {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .add-button {
            background-color: #4CAF50;
        }
        .add-button:hover {
            background-color: #45a049;
        }
        .delete-all-button {
            background-color: #ff4d4d;
        }
        .delete-all-button:hover {
            background-color: #ff3333;
        }
        .call-type-header {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .button-container {
            display: flex;
            gap: 10px;
        }
        .priority-status-flash {
            animation: flash-background-priority 1s infinite;
        }
        .go-status-flash {
            animation: flash-background-go 2s infinite;
        }
        .grab-status-flash {
            animation: flash-background-grab 1s infinite;
        }
        .priority1-status-flash {
            animation: flash-background-priority1 0.5s infinite;
        }
        .priority2-status-flash {
            animation: flash-background-priority2 1s infinite;
        }
        @keyframes flash-background-priority {
            0% { background-color: #212224; }
            50% { background-color: red; }
            100% { background-color: #212224; }
        }
        @keyframes flash-background-go {
            0% { background-color: #212224; }
            50% { background-color: green; }
            100% { background-color: #212224; }
        }
        @keyframes flash-background-grab {
            0% { background-color: #212224; }
            50% { background-color: blue; }
            100% { background-color: #212224; }
        }
        @keyframes flash-background-priority1 {
            0% { background-color: #212224; }
            50% { background-color: red; }
            100% { background-color: #212224; }
        }
        @keyframes flash-background-priority2 {
            0% { background-color: #212224; }
            50% { background-color: orange; }
            100% { background-color: #212224; }
        }
    </style>
</head>
<body>
    <div class="time-display" id="time-display"></div>
    <div class="button-container">
        <button class="add-button" onclick="addStrip()">Add</button>
        <button class="delete-all-button" onclick="confirmRemoveAllStrips()">Delete All</button>
    </div>
    <div id="container"></div>

    <script>
    document.addEventListener("DOMContentLoaded", loadStrips);

    // Add event listener for the space bar to add a new strip
    document.addEventListener('keydown', function(event) {
        if (event.code === 'Space' && !event.target.matches('input, textarea')) {
            event.preventDefault(); // Prevent the default action (scrolling down the page)
            addStrip();
        }
    });

    function getCurrentTime() {
        const now = new Date();
        return now.toLocaleTimeString('en-GB', { hour12: false });
    }

    function updateTimeDisplay() {
        const timeDisplay = document.getElementById('time-display');
        timeDisplay.textContent = getCurrentTime();
    }

    setInterval(updateTimeDisplay, 1000); // Update time display every second

    function addStrip(respondingUnits = "", callType = "", mapPage = "", placeName = "", address = "", notes = "", callCategory = "", priorityStatus = "") {
        if (!notes) { // Check if notes is empty and if so, set to current time
            notes = getCurrentTime();
        }

        const container = document.getElementById('container');
        const strip = document.createElement('div');
        strip.className = 'strip';
        updatePriorityStatusClass(strip, priorityStatus);

        strip.innerHTML = `
            <div class="call-type-header" style="color: ${getCategoryColor(callCategory)};">
                <span class="header-text">${callType}</span>
            </div>
            <div class="input-group">
                <input type="text" class="responding-units" placeholder="Responding Units" value="${respondingUnits}">
                <input type="text" class="call-type" placeholder="Call Type" value="${callType}" oninput="handleCallTypeInput(event)">
            </div>
            <div class="map-place-container">
                <input type="text" class="map-page" placeholder="Map Page" value="${mapPage}">
                <input type="text" class="place-name" placeholder="Place Name" value="${placeName}">
                <input type="text" class="full-width" placeholder="Address" value="${address}">
            </div>
            <div class="notes-container">
                <input type="text" class="notes" placeholder="Notes" value="${notes}">
                <select class="call-category" onchange="updateCategory(this)">
                    <option value="" ${callCategory === "" ? "selected" : ""}>Select Category</option>
                    <option value="Medical" ${callCategory === "Medical" ? "selected" : ""}>Medical</option>
                    <option value="MVA" ${callCategory === "MVA" ? "selected" : ""}>MVA</option>
                    <option value="Alarm" ${callCategory === "Alarm" ? "selected" : ""}>Alarm</option>
                    <option value="Investigation" ${callCategory === "Investigation" ? "selected" : ""}>Investigation</option>
                    <option value="Standby" ${callCategory === "Standby" ? "selected" : ""}>Standby</option>
                    <option value="Fire" ${callCategory === "Fire" ? "selected" : ""}>Fire</option>
                    <option value="Special" ${callCategory === "Special" ? "selected" : ""}>Special</option>
                    <option value="Other" ${callCategory === "Other" ? "selected" : ""}>Other</option>
                </select>
                <select class="priority-status" onchange="updatePriorityStatus(this)">
                    <option value="" ${priorityStatus === "" ? "selected" : ""}>Select</option>
                    <option value="Grab" ${priorityStatus === "Grab" ? "selected" : ""}>Grab</option>
                    <option value="Priority 1" ${priorityStatus === "Priority 1" ? "selected" : ""}>Priority 1</option>
                    <option value="Priority 2" ${priorityStatus === "Priority 2" ? "selected" : ""}>Priority 2</option>
                    <option value="Go" ${priorityStatus === "Go" ? "selected" : ""}>Go</option>
                </select>
                <button onclick="removeStrip(this)">Remove</button>
            </div>
        `;

        container.appendChild(strip);
        saveStrips();
    }

    function handleCallTypeInput(event) {
        const inputElement = event.target;
        const callType = inputElement.value.trim().toLowerCase();
        const strip = inputElement.closest('.strip');
        const categorySelect = strip.querySelector('.call-category');

        if (callType.includes("mva")) {
            categorySelect.value = "MVA";
        } else if (callType.includes("med") || callType.includes("inj") || callType.includes("sick") || callType.includes("fall") || callType.includes("uncon")) {
            categorySelect.value = "Medical";
        } else if (callType.includes("alarm")) {
            categorySelect.value = "Alarm";
        } else if (callType.includes("inv")) {
            categorySelect.value = "Investigation";
        } else if (callType.includes("standby")) {
            categorySelect.value = "Standby";
        } else if (callType.includes("fire")) {
            categorySelect.value = "Fire";
        } else if (callType.includes("spec")) {
            categorySelect.value = "Special";
        } else {
            categorySelect.value = "";
        }

        updateCategory(categorySelect);
    }

    function updateCategory(selectElement) {
        const strip = selectElement.closest('.strip');
        const headerText = strip.querySelector('.call-type-header .header-text');
        const selectedCategory = selectElement.value;
        headerText.style.color = getCategoryColor(selectedCategory);
        saveStrips();
    }

    function getCategoryColor(category) {
    switch (category) {
        case "Medical":
            return "skyblue";
        case "MVA":
            return "magenta";
        case "Alarm":
            return "pink";
        case "Investigation":
            return "green";
        case "Standby":
            return "yellow";
        case "Fire":
            return "#cc5500"; //orange
        case "Special":
            return "#1f1f1f"; //red
        case "Other":
            return "white";
        default:
            return "white";
        }
    }

    function updatePriorityStatus(selectElement) {
        const strip = selectElement.closest('.strip');
        const selectedPriority = selectElement.value;
        updatePriorityStatusClass(strip, selectedPriority);

        // Automatically open Google Maps for "Go" status
        if (selectedPriority === 'Go') {
            const address = strip.querySelector('.full-width').value;
            const origin = '365 W 5th Ave, Vancouver, BC';
            const destination = encodeURIComponent(address);
            window.open(`https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`, '_blank');
        }

        saveStrips();
    }

    function updatePriorityStatusClass(strip, selectedPriority) {
        strip.classList.remove('priority-status-flash', 'go-status-flash', 'grab-status-flash', 'priority1-status-flash', 'priority2-status-flash');
        switch (selectedPriority) {
            case 'Grab':
                strip.classList.add('grab-status-flash');
                break;
            case 'Priority 1':
                strip.classList.add('priority1-status-flash');
                break;
            case 'Priority 2':
                strip.classList.add('priority2-status-flash');
                break;
            case 'Go':
                strip.classList.add('go-status-flash');
                break;
        }
    }

    function removeStrip(buttonElement) {
        const strip = buttonElement.closest('.strip');
        strip.remove();
        saveStrips();
    }

    function confirmRemoveAllStrips() {
        if (confirm("Are you sure you want to remove all strips?")) {
            removeAllStrips();
        }
    }

    function removeAllStrips() {
        const container = document.getElementById('container');
        container.innerHTML = '';
        saveStrips();
    }

    function saveStrips() {
        const strips = Array.from(document.querySelectorAll('.strip')).map(strip => {
            return {
                respondingUnits: strip.querySelector('.responding-units').value,
                callType: strip.querySelector('.call-type').value,
                mapPage: strip.querySelector('.map-page').value,
                placeName: strip.querySelector('.place-name').value,
                address: strip.querySelector('.full-width').value,
                notes: strip.querySelector('.notes').value,
                callCategory: strip.querySelector('.call-category').value,
                priorityStatus: strip.querySelector('.priority-status').value
            };
        });
        localStorage.setItem('strips', JSON.stringify(strips));
    }

    function loadStrips() {
        const strips = JSON.parse(localStorage.getItem('strips')) || [];
        strips.forEach(strip => {
            addStrip(strip.respondingUnits, strip.callType, strip.mapPage, strip.placeName, strip.address, strip.notes, strip.callCategory, strip.priorityStatus);
        });
    }
    </script>
</body>
</html>
